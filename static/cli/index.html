<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Client Testing</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
  <div class="container mx-auto p-4">
    <h1 class="text-xl font-bold mb-4">API Client Testing</h1>

    <!-- Workspace selection -->
    <label for="workspaceSelect" class="block mb-2">Select Workspace:</label>
    <select id="workspaceSelect" class="w-full border mb-4 p-2">
      <!-- Options will be populated by JavaScript -->
    </select>

    <!-- Create Workspace -->
    <h2 class="text-lg font-bold mt-4">Create Workspace:</h2>
    <input id="workspaceName" type="text" class="w-full border mb-2 p-2" placeholder="Workspace Name">
    <textarea id="workspaceConfig" rows="3" class="w-full border mb-4 p-2" placeholder="Workspace Config"></textarea>
    <button id="createWorkspaceBtn" class="bg-green-500 text-white px-4 py-2 mb-4">Create Workspace</button>

    <!-- Textarea for curl command input -->
    <textarea id="curlCommand" rows="5" class="w-full border mb-4 p-2" placeholder="Enter curl command"></textarea>
    <button id="executeBtn" class="bg-blue-500 text-white px-4 py-2">Execute</button>

    <!-- Response display -->
    <h2 class="text-lg font-bold mt-4">Response:</h2>
    <pre id="responseOutput" class="bg-gray-200 p-4 mt-2"></pre>

    <!-- History display -->
    <h2 class="text-lg font-bold mt-4">History:</h2>
    <ul id="historyList" class="mt-2"></ul>
  </div>

  <script>
document.getElementById('executeBtn').addEventListener('click', async () => {
  const command = document.getElementById('curlCommand').value;
  const workspace = document.getElementById('workspaceSelect').value; // Get the selected workspace
  const response = await fetch('/execute', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ command, workspace }), // Send workspace with the command
  }).then(res => res.json());

  document.getElementById('responseOutput').innerText = response.response;
  loadHistory();  // Reload history after execution
});


    document.getElementById('createWorkspaceBtn').addEventListener('click', async () => {
      const name = document.getElementById('workspaceName').value;
      const config = document.getElementById('workspaceConfig').value;
      const response = await fetch('/workspace', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ name, config }),
      }).then(res => res.json());

      alert(response.message);
      loadWorkspaces();  // Reload workspaces after creation
    });

    async function loadHistory() {
      const history = await fetch('/history').then(res => res.json());
      const historyList = document.getElementById('historyList');
      historyList.innerHTML = '';
      history.forEach(item => {
        historyList.innerHTML += `<li>${item.Command} - ${item.Timestamp}</li>`;
      });
    }

    async function loadWorkspaces() {
      const workspaces = await fetch('/workspaces').then(res => res.json());
      const workspaceSelect = document.getElementById('workspaceSelect');
      workspaceSelect.innerHTML = '';
      workspaces.forEach(workspace => {
        workspaceSelect.innerHTML += `<option value="${workspace.Name}">${workspace.Name}</option>`;
      });
    }

    loadHistory();  // Initial load of history on page load
    loadWorkspaces();  // Initial load of workspaces on page load
  </script>
</body>
</html>
